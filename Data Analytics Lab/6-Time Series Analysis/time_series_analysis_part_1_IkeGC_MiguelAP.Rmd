---
title: "Linear Regression"
author: "Miguel Albertí Pons &Iker González Cuellar"
date: "09-01-23"
output:
  html_document: default
---

```{=html}
<style type="text/css">
.main-container {
  max-width: 1500px;
  margin-left: auto;
  margin-right: auto;
}
</style>
```

------------------------------------------------------------------------

```{r message=FALSE}
library(dplyr)
library(reshape2)
library(magrittr)
```

## Ejercicio 1

**Read the data, create 4 univariate time series (IPC index, Monthly variation of IPC index, Yearly**

**variation of IPC index, Variation of IPC index from the begining of the year) and one 4-dimesional**

**time series as the union of the previous 4 (use ts.union). Plot the 4-dim time series.**

```{r}
ipcDataRaw = read.csv("_repository/INE_IPC.csv", sep = ",")

#ipcFullTable = ipcDataRaw[6:19,]
#ipcFullTable.ts = ts(ipcFullTable)

# IPC INDEX Transformación
# ----------------------------------
table_range = 1:196
ipcIndex = ipcDataRaw[c(6,7),table_range]
names(ipcIndex) = ipcIndex[1,]
ipcIndex = ipcIndex[-1,] %>% rename(., id = 1) %>% melt(., id = "id") %>% rename(., date = 2, index = 3) %>% .[,2:3] %>% arrange(., desc(date)) %>% transform(., index = as.double(index))
ipcIndex.ts = ts(ipcIndex[2], frequency = 16)

# Monthly variation of IPC index Transformación
# ----------------------------------
table_range = 197:390
IPCmonthVariation = ipcDataRaw[c(6,7),table_range]
names(IPCmonthVariation) = IPCmonthVariation[1,]
IPCmonthVariation = IPCmonthVariation[-1,] %>% rename(., id = 1) %>% melt(., id = "id") %>% rename(., date = 2, index = 3) %>% .[,2:3]  %>% arrange(., desc(date)) %>% transform(., index = as.double(index))
IPCmonthVariation.ts = ts(IPCmonthVariation[2], frequency = 16)

# Yearly variation of IPC index Transformación
# ----------------------------------
table_range = 391:585
IPCyearVariation = ipcDataRaw[c(6,7),table_range]
names(IPCyearVariation) = IPCyearVariation[1,]
IPCyearVariation = IPCyearVariation[-1,] %>% rename(., id = 1) %>% melt(., id = "id") %>% rename(., date = 2, index = 3) %>% .[,2:3] %>% arrange(., desc(date))%>% transform(., index = as.double(index))
IPCyearVariation.ts = ts(IPCyearVariation[2], frequency = 16)

# Variation of IPC index from the begining of the year Transformación
# ----------------------------------
table_range = 586:780
IPCVariationBegining = ipcDataRaw[c(6,7),table_range]
names(IPCVariationBegining) = IPCVariationBegining[1,]
IPCVariationBegining = IPCVariationBegining[-1,] %>% rename(., id = 1) %>% melt(., id = "id") %>% rename(., date = 2, index = 3) %>% .[,2:3] %>% arrange(., desc(date)) %>% transform(., index = as.double(index))
IPCVariationBegining.ts = ts(IPCVariationBegining[2], frequency = 16)



# Plots
# ----------------------------------
plot(ipcIndex.ts, ylab="",main="IPC Index")
plot(IPCmonthVariation.ts, ylab="",main="Monthly variation of IPC index")
plot(IPCyearVariation.ts, ylab="",main="Yearly variation of IPC index")
plot(IPCVariationBegining.ts, ylab="", main="Variation of IPC index from the begining of the year")


plot(ts.union(ipcIndex.ts, IPCmonthVariation.ts, IPCyearVariation.ts, IPCVariationBegining.ts),  ylab="", main = "", las = 1)


```

## Ejercicio 2

**Answer the following questions:**

-   **Which series have a seasonal pattern?**

    Un patrón estacional se puede encontrar en aquellas series que se ven afectadas por factores como el día de la semana o la estación del año. Por ejemplo, el número de turistas que van a Mallorca, si viésemos una gráfica, veríamos que año tras año en verano se alcanzan los picos más altos y en inviernos los más bajos.

-   **Which series are stationary?**

    Las series estacionarias son aquellas que no varían con el tiempo, es decir, su **media** **y** **varianza** **no cambian con el tiempo**. Un ejemplo sería la variación de la población de linces, a lo largo de los años el número de linces aumenta hasta el punto donde ya no hay comida suficiente para todos, en este punto, los individuos de linces empiezan a disminuir hasta que vuelve a ver suficiente alimento y la población vuelve a aumentar. Los momentos donde estos cambios ocurrirán son impredecibles, esto hace que sea una serie estacionaria.

## Ejercicio 3

**Compute the lag 12 differences of the IPC time series (using function diff). Then plot the union of 3 time series: IPC, its lag 12 differences, and the series containing yearly variation of IPC index we read from file INE_IPC.csv. Do you think that yearly variation of IPC index is stationary in variance?**

```{r}
ipcLag12.ts = diff(log(ipcIndex.ts),lag=12)

plot(ts.union(ipcLag12.ts, ipcIndex.ts, IPCyearVariation.ts),  ylab="", main = "", las = 1)
```

## Ejercicio 4

**Compute the Inflation as Inflation \<- 100\*diff(IPC,lag=12)/lag(IPC,k=-12).**

**• Is Inflation of class ts?**

**• Why do you think Inflation is so similar to the yearly variation of IPC index?**

```{r}
divisor = na.omit(lag(ipcIndex,k=-12))
dim(divisor)


dividendo = 100*diff(ipcIndex,lag=12)
dim(dividendo)
df_dividendo = data.frame(dividendo)
dim(df_dividendo)


Inflation = dividendo/divisor
plot(Inflation, ylab="",main="Inflation")

```

## Ejercicio 5

**Compute and plot the Autocorrelation Functions (ACFs) of the following time series:**

**• The 4 we read from file INE_IPC.csv.**

**• The inflation time series.**

**• The IPC series after having taken consecutively differences with lags 1 (regular difference) and 12**

**(seasonal difference). Plot this series previously: diff( diff(IPC,lag=1), lag=12). Do you think it**

**is stationary?**

```{r}

```
